!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("React"),require("xtag")):"function"==typeof define&&define.amd?define(["React","xtag"],e):"object"==typeof exports?exports.xblocks=e(require("React"),require("xtag")):t.xblocks=e(t.React,t.xtag)}(this,function(t,e){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";e.create=n(1).create,e.dom=n(2),e.event=n(36),e.utils=n(11),e.view=n(32)},function(t,e,n){"use strict";var r=n(2),o=n(11),i=n(35),s=n(38),a=Array.prototype.forEach,u={init:function(t){return t.xtagName?!1:(t.xtagName=t.tagName.toLowerCase(),t.xtmpl={},t.xuid=o.seq(),t.xprops=o.propTypes(t.xtagName),t.xinserted=!1,!0)},tmplCompile:function(t){this.xtmpl[t.getAttribute("ref")]=t.innerHTML},create:function(t){t.hasChildNodes()&&a.call(t.querySelectorAll('script[type="text/x-template"][ref],template[ref]'),u.tmplCompile,t),t.xblock=new i(t)},createLazy:function(t){t.forEach(u.create)}},c={lifecycle:{created:function(){o.log.time(this,"xb_init"),o.log.time(this,"dom_inserted"),u.init(this)},inserted:function(){if(!this.xinserted){u.init(this),this.xinserted=!0;var t=Boolean(this.querySelector("script"));t?o.lazy(u.createLazy,this):u.create(this),o.log.time(this,"dom_inserted")}},removed:function(){if(this.xinserted=!1,this.xblock){var t=this.content;this.xblock.destroy(),this.xblock=void 0,this.content=t}},attributeChanged:function(t,e,n){"xb-static"===t&&null===n&&this.xblock&&!this.mounted&&this.xblock.repaint()}},accessors:{mounted:{get:function(){return Boolean(this.xblock&&this.xblock.isMounted())}},content:{get:function(){return this.mounted?this.xblock.getMountedContent():r.contentNode(this).innerHTML},set:function(t){this.mounted?this.xblock.setMountedContent(t):(r.contentNode(this).innerHTML=t,this.upgrade())}},attrs:{get:function(){return r.attrs.toObject(this)}},state:{get:function(){var t,e=r.attrs.toObject(this),n=this.xprops,o=s.tags[this.xtagName].accessors,i=c.accessors;for(t in o)n.hasOwnProperty(t)&&o.hasOwnProperty(t)&&!i.hasOwnProperty(t)&&(e[t]=this[t]);return r.attrs.typeConversion(e,n),e}},outerHTML:r.outerHTML},methods:{upgrade:function(){r.upgradeAll(this)},cloneNode:function(t){var e=r.cloneNode(this,!1);return r.upgrade(e),e.xtmpl=this.xtmpl,e.xinserted=!1,t&&(e.content=this.content),e}}};e.create=function(t,e){e=Array.isArray(e)?e:[e],e.unshift(!0,{}),e.push(c);for(var n,r,i=2,a=e.length;a>i;i++)r=e[i],o.isPlainObject(r)&&(!n&&r.prototype&&(n=r.prototype),delete r.prototype);return e=o.merge.apply({},e),n&&(e.prototype=n),s.register(t,e)}},function(t,e,n){"use strict";e.attrs=n(3),e.cloneNode=n(5),e.contentNode=n(7),e.outerHTML=n(8),e.upgrade=n(9),e.upgradeAll=n(10)},function(t,e,n){"use strict";function r(t){this[t.nodeName]=t.value}function o(t,e,n){switch(n||("true"===e||"false"===e||-1!==a.indexOf(t))&&(n=i.PropTypes.bool),n){case i.PropTypes.bool:return Boolean(e===!0||""===e||t===e||"true"===e);case i.PropTypes.string:return String(e);case i.PropTypes.number:return Number(e);default:return e}}var i=n(4),s=Array.prototype.forEach,a=["active","autofocus","checked","defer","disabled","ismap","multiple","readonly","required","selected","xb-static"];e.get=function(t,e){if(1!==t.nodeType||!t.hasAttributes())return e;var n;for(n in e)e.hasOwnProperty(n)&&t.hasAttribute(n)&&("boolean"==typeof e[n]?e[n]=o(n,t.getAttribute(n),i.PropTypes.bool):e[n]=t.getAttribute(n));return e},e.toObject=function(t){var e={};return 1===t.nodeType&&t.hasAttributes()&&s.call(t.attributes,r,e),e},e.valueConversion=o,e.typeConversion=function(t,e){e=e||{};var n;for(n in t)t.hasOwnProperty(n)&&(t[n]=o(n,t[n],e[n]));return t}},function(e,n){e.exports=t},function(t,e,n){"use strict";var r=n(6),o=(r.HTMLElement||r.Element).prototype;t.exports=function(t,e){return o.cloneNode.call(t,e)}},function(t,e){"use strict";t.exports=function(){return this||(1,eval)("this")}()},function(t,e){"use strict";t.exports=function(t){var e;return t.xuid&&1===t.nodeType&&t.hasChildNodes()&&(e=t.querySelector('[data-xb-content="'+t.xuid+'"]'),e||(e=t.querySelector('script[type="text/x-template"]:not([ref]),template:not([ref])'))),e||t}},function(t,e,n){"use strict";var r=n(6);t.exports=function(){var t,e,n=r.document.createElementNS("http://www.w3.org/1999/xhtml","_");if(n.hasOwnProperty("outerHTML"))t=function(){return this.outerHTML},e=function(t){this.outerHTML=t};else{var o=r.XMLSerializer&&new r.XMLSerializer,i=/\sxmlns=\"[^\"]+\"/;t=o?function(){return o.serializeToString(this).replace(i,"")}:function(){n.appendChild(this.cloneNode(!1));var t=n.innerHTML.replace("><",">"+this.innerHTML+"<");return n.innerHTML="",t},e=function(t){var e,o=this,i=o.parentNode;if(!i)throw r.DOMException.code=r.DOMException.NOT_FOUND_ERR,r.DOMException;for(n.innerHTML=t;e=n.firstChild;)i.insertBefore(e,o);i.removeChild(o)}}return{get:t,set:e}}()},function(t,e,n){"use strict";var r=n(6);t.exports=function(){return r.CustomElements&&"function"==typeof r.CustomElements.upgrade?r.CustomElements.upgrade:function(){}}()},function(t,e,n){"use strict";var r=n(6);t.exports=function(){return r.CustomElements&&"function"==typeof r.CustomElements.upgradeAll?r.CustomElements.upgradeAll:function(){}}()},function(t,e,n){"use strict";e.assign=n(12),e.equals=n(17),e.isPlainObject=n(14),e.lazy=n(18),e.log=n(29),e.merge=n(16),e.pristine=n(30),e.propTypes=n(31),e.seq=n(33),e.tmpl=n(34),e.type=n(15)},function(t,e,n){"use strict";function r(){return!0}var o=n(13);t.exports=function(){return o.call(this,r,arguments)}},function(t,e,n){"use strict";var r=n(14),o=n(16);t.exports=function(t,e){var n,i,s,a,u,c,p=e[0]||{},l=1,f=e.length,d=!1;for("boolean"==typeof p&&(d=p,p=e[l]||{},l++),"object"!=typeof p&&"function"!=typeof p&&(p={}),l===f&&(p=this,l--);f>l;l++)if(null!=(n=e[l]))for(i in n)s=p[i],a=n[i],p!==a&&(d&&a&&(r(a)||(u=Array.isArray(a)))?(u?(u=!1,c=s&&Array.isArray(s)?s:[]):c=s&&r(s)?s:{},p[i]=o(d,c,a)):t(a)&&(p[i]=a));return p}},function(t,e,n){"use strict";var r=n(15);t.exports=function(t){return"object"!==r(t)?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0}},function(t,e){"use strict";var n=Object.prototype.toString,r=/\s([a-zA-Z]+)/;t.exports=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=typeof t;if("object"===e&&(e=n.call(t).match(r)[1].toLowerCase()),"number"===e){var o=t.toString();e="NaN"===o?"NaN":-1===o.indexOf(".")?"integer":"float"}return e}},function(t,e,n){"use strict";function r(t){return void 0!==t}var o=n(13);t.exports=function(){return o.call(this,r,arguments)}},function(t,e,n){"use strict";function r(t,e){if(t===e)return!0;var n=o(t),r=o(e);return n!==r?!1:i.hasOwnProperty(n)?i[n](t,e):t==e}var o=n(15),i={array:function(t,e){var n=0,o=t.length;if(o!==e.length)return!1;for(;o>n;n++)if(!r(t[n],e[n]))return!1;return!0},object:function(t,e){var n;for(n in t){if(!e.hasOwnProperty(n))return!1;if(!r(t[n],e[n]))return!1}for(n in e)if(!t.hasOwnProperty(n))return!1;return!0},date:function(t,e){return t.getTime()===e.getTime()},regexp:function(t,e){return t.toString()===e.toString()},"function":function(t,e){return t.toString()===e.toString()}};t.exports=r},function(t,e,n){"use strict";var r=n(19);t.exports=function(t,e){return t._args||(t._args=[]),t._args.push(e),t._timer||(t._timer=r.setImmediate(function(){t._timer=0;var e=t._args;t._args=[],t(e)})),t}},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.canUse())return r.init()}return e.init()}var o,i,s=n(20),a=n(21),u=n(22),c=n(23),p=[n(24),n(25),n(26),n(27),n(28)];a()?(o=s.setImmediate||s.msSetImmediate||r(p,c),i=s.clearImmediate||s.msClearImmediate||u.clear):(o=c.init(),i=u.clear),e.setImmediate=o,e.clearImmediate=i,e.msSetImmediate=o,e.msClearImmediate=i},function(t,e){"use strict";t.exports=function(){return this||(1,eval)("this")}()},function(t,e,n){var r=n(20);t.exports=function(){return!(r.navigator&&/Trident|Edge/.test(r.navigator.userAgent))}},function(t,e,n){"use strict";function r(t){var e=Array.prototype.slice.call(arguments,1);return function(){t.apply(void 0,e)}}function o(t){return c[u]=r.apply(void 0,t),u++}function i(t){delete c[t]}function s(t){if(p)a.setTimeout(r(s,t),0);else{var e=c[t];if(e){p=!0;try{e()}finally{i(t),p=!1}}}}var a=n(20),u=1,c={},p=!1;e.run=s,e.wrap=r,e.create=o,e.clear=i},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t=function(){var t=o.create(arguments);return r.setTimeout(o.wrap(o.run,t),0),t};return t.usePolifill="setTimeout",t},e.canUse=function(){return!0}},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t=function(){var t=o.create(arguments);return r.process.nextTick(o.wrap(o.run,t)),t};return t.usePolifill="nextTick",t},e.canUse=function(){return"[object process]"===Object.prototype.toString.call(r.process)}},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t="setImmediate$"+Math.random()+"$",e=function(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(t)&&o.run(Number(e.data.slice(t.length)))};r.addEventListener?r.addEventListener("message",e,!1):r.attachEvent("onmessage",e);var n=function(){var e=o.create(arguments);return r.postMessage(t+e,"*"),e};return n.usePolifill="postMessage",n},e.canUse=function(){if(r.importScripts||!r.postMessage)return!1;var t=!0,e=r.onmessage;return r.onmessage=function(){t=!1},r.postMessage("","*"),r.onmessage=e,t}},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t=new r.MessageChannel;t.port1.onmessage=function(t){o.run(Number(t.data))};var e=function(){var e=o.create(arguments);return t.port2.postMessage(e),e};return e.usePolifill="messageChannel",e},e.canUse=function(){return Boolean(r.MessageChannel)}},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t=r.document.documentElement,e=function(){var e=o.create(arguments),n=r.document.createElement("script");return n.onreadystatechange=function(){o.run(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n),e};return e.usePolifill="readyStateChange",e},e.canUse=function(){return r.document&&"onreadystatechange"in r.document.createElement("script")}},function(t,e,n){"use strict";var r=n(20),o=n(22);e.init=function(){var t=function(){var t=o.create(arguments),e=new r.Image;return e.onload=e.onerror=o.wrap(o.run,t),e.src="",t};return t.usePolifill="image",t},e.canUse=function(){return Boolean(r.window&&r.Image)}},function(t,e){"use strict";e.time=function(){}},function(t,e,n){"use strict";var r=n(6),o=/^[\$_a-z][\$\w]*$/i;t.exports=function(t){if(!t)return!1;var e=r[t];if(!e)return!1;if(!o.test(t))return!1;var n=typeof e;if("function"!==n&&"object"!==n)return!1;var i=new RegExp("function\\s+"+t+"\\(\\s*\\)\\s*{\\s*\\[native code\\]\\s*}");return i.test(e)&&("function"!==n||e.valueOf&&e.valueOf()===e)?!0:!1}},function(t,e,n){"use strict";var r=n(32);t.exports=function(t){var e=r.getClass(t);return e?e.propTypes?e.propTypes:e.originalSpec&&e.originalSpec.propTypes?e.originalSpec.propTypes:{}:{}}},function(t,e,n){"use strict";function r(t){return t=Array.isArray(t)?t:[t],t.unshift(!0,{},u),t.push(a),o.createClass(i.apply({},t))}var o=n(4),i=n(16),s={},a={propTypes:{_uid:o.PropTypes.node,_container:o.PropTypes.any,children:o.PropTypes.node,"xb-static":o.PropTypes.bool},template:function(t,e){var n=this.props._container&&this.props._container.xtmpl;return"object"==typeof n&&null!==n&&n.hasOwnProperty(t)?(e=i.apply({},e,{dangerouslySetInnerHTML:{__html:this.templatePrepare(n[t])}}),o.createElement("div",e)):null},container:function(){return this.props._container}},u={templatePrepare:function(t){return t}};e.create=r,e.register=function(t,e){if(o.DOM.hasOwnProperty(t))throw'Specified item "'+t+'" is already defined';var n=r(e);return s[t]=n,o.DOM[t]=o.createFactory(n),n},e.getFactory=function(t){return o.DOM[t]},e.getClass=function(t){return s[t]}},function(t,e){"use strict";var n=0;t.exports=function(){return++n}},function(t,e){"use strict";var n={};t.exports=function(t,e){return n.hasOwnProperty(t)||(n[t]=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');")),e?n[t](e):n[t]}},function(t,e,n){"use strict";function r(t){t.xblock=this,this._node=t,this._init(t.state,t.content,this._callbackInit)}var o=n(6),i=n(2),s=n(36),a=n(4),u=n(11),c=n(32);t.exports=r;var p={checkNodeChange:function(t){return"childList"===t.type},checkAttributesChange:function(t){return"attributes"===t.type},filterAttributesRemove:function(t){return"attributes"===t.type&&!this._node.hasAttribute(t.attributeName)},mapAttributesName:function(t){return t.attributeName},globalInitEvent:function(t){s.dispatch(o,"xb-created",{detail:{records:t}})},globalRepaintEvent:function(t){s.dispatch(o,"xb-repaint",{detail:{records:t}})}};r.prototype._node=null,r.prototype._component=null,r.prototype._observer=null,r.prototype.destroy=function(){a.unmountComponentAtNode(this._node),this.unmount(),s.dispatch(this._node,"xb-destroy",{bubbles:!1,cancelable:!1})},r.prototype.unmount=function(){this._observer&&this._observer.disconnect(),this.isMounted()&&this._component.unmountComponent(),this._component=null},r.prototype.update=function(t,e,n){if(this.isMounted()){var r=this._node.state,o="setProps";if("object"==typeof t){var s;for(s in t)t.hasOwnProperty(s)&&(r[s]=t[s])}if(Array.isArray(e)&&e.length){o="replaceProps",r=u.merge(!0,{},this.getMountedProps(),r);for(var a=e.length;a--;)r.hasOwnProperty(e[a])&&delete r[e[a]]}r.hasOwnProperty("xb-static")?this.repaint(n):(i.attrs.typeConversion(r,this._node.xprops),this._component[o](r,this._callbackUpdate.bind(this,n)))}},r.prototype.repaint=function(t){var e,n=this._node.content,r=this._node.state,o=this.getMountedProps()||{};for(e in o)o.hasOwnProperty(e)&&(r[e]=o[e]);this.destroy(),this._init(r,n,this._callbackRepaint.bind(this,t))},r.prototype.isMounted=function(){return Boolean(this._component&&this._component.isMounted())},r.prototype.setMountedContent=function(t){this.isMounted()&&this.update({children:t})},r.prototype.getMountedContent=function(){return this.isMounted()?this._component.props.children:void 0},r.prototype.getMountedComponent=function(){return this.isMounted()?this._component:void 0},r.prototype.getMountedProps=function(){return this.isMounted()?this._component.props:null},r.prototype._init=function(t,e,n){if(!this.isMounted()){t._uid=this._node.xuid,t._container=this._node,i.attrs.typeConversion(t,this._node.xprops);var r=c.getFactory(this._node.xtagName)(t,e);if(t.hasOwnProperty("xb-static"))this.unmount(),u.log.time(this._node,"react_render"),this._node.innerHTML=a.renderToStaticMarkup(r),u.log.time(this._node,"react_render"),this._node.upgrade(),n&&n.call(this);else{u.log.time(this._node,"react_render");var o=this;this._component=a.render(r,this._node,function(){u.log.time(o._node,"react_render"),o._component=this,o._callbackRender(n)})}}},r.prototype._callbackInit=function(){s.dispatch(this._node,"xb-created"),u.lazy(p.globalInitEvent,this._node),u.log.time(this._node,"xb_init")},r.prototype._callbackRepaint=function(t){s.dispatch(this._node,"xb-repaint"),u.lazy(p.globalRepaintEvent,this._node),t&&t.call(this)},r.prototype._callbackRender=function(t){this._node.upgrade(),this._observer||(this._observer=new o.MutationObserver(this._callbackMutation.bind(this))),this._observer.observe(this._node,{attributes:!0,childList:!0,characterData:!0,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1,attributeFilter:Object.keys(this._node.xprops)}),t&&t.call(this)},r.prototype._callbackMutation=function(t){if(this.isMounted())if(t.some(p.checkNodeChange))this.repaint();else if(t.some(p.checkAttributesChange)){var e=t.filter(p.filterAttributesRemove,this).map(p.mapAttributesName);this.update(null,e)}},r.prototype._callbackUpdate=function(t){this._node.upgrade(),s.dispatch(this._node,"xb-update"),t&&t.call(this)}},function(t,e,n){"use strict";var r=n(6),o=n(30),i=n(37),s=function(){return o("CustomEvent")?r.CustomEvent:i}();e.Custom=s,e.dispatch=function(t,e,n){t.dispatchEvent(new s(e,n||{}))}},function(t,e,n){"use strict";var r,o=n(6),i=!1;try{i=Boolean(o.document.createEvent("CustomEvent"))}catch(s){}r=i?function(t,e){e=e||{};var n=Boolean(e.bubbles),r=Boolean(e.cancelable),i=o.document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e.detail),i}:function(t,e){e=e||{};var n=Boolean(e.bubbles),r=Boolean(e.cancelable),i=o.document.createEvent("Event");return i.initEvent(t,n,r),i.detail=e.detail,i},r.prototype=o.Event.prototype,t.exports=r},function(t,n){t.exports=e}])});