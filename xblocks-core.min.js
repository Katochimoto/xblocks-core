!function(){"use strict";var t,e={};t="undefined"!=typeof module?module.exports=e:function(){return this||(1,eval)("this")}(),t.xblocks=e,function(t){t.uid=function(){return Math.floor(268435456*(1+Math.random())+Date.now()).toString(36)},t.noop=function(){},t.merge=function(){var e=arguments.length,n=1,o=arguments[0]||{},r=!1;return"boolean"===t.type(o)&&(r=o,o=arguments[n]||{},n++),"object"!==t.type(o)&&"function"!==t.type(o)&&(o={}),n===e&&(o=this,n--),Array.prototype.slice.call(arguments,n).filter(function(e){return"object"===t.type(e)}).forEach(function(e){Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);if(r&&"object"===t.type(i.value)){var s=o[n],c=s&&t.isPlainObject(s)?s:{};i.value=t.merge(r,c,i.value)}Object.defineProperty(o,n,i)})}),o},t.type=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},t.isPlainObject=function(e){return"object"!==t.type(e)||e.nodeType||t.isWindow(e)?!1:e.constructor&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0},t.isWindow=function(t){return null!=t&&t===t.window},t.equals=function(e,n){if(e===n)return!0;if(!(e instanceof Object&&n instanceof Object))return!1;if(e.constructor!==n.constructor)return!1;for(var o in e)if(e.hasOwnProperty(o)){if(!n.hasOwnProperty(o))return!1;if(e[o]!==n[o]){if("object"!=typeof e[o])return!1;if(!t.equals(e[o],n[o]))return!1}}for(o in n)if(n.hasOwnProperty(o)&&!e.hasOwnProperty(o))return!1;return!0},t.isEmptyObject=function(e){if("object"!==t.type(e))return!0;var n;for(n in e)return!1;return!0},t.filterObject=function(t,e){var n={};return Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);e&&e(o,r)&&Object.defineProperty(n,o,r)}),n},t.mapObject=function(e,n){var o={};return Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r),s=n&&n(r,i);"object"===t.type(s)&&Object.defineProperty(o,s.name,s.descr)}),o}}(e),function(t){t.dom={},t.dom.attrs={},t.dom.attrs.ARRTS_BOOLEAN=["checked","selected","disabled","readonly","multiple","ismap","defer","autofocus","xb-static"],t.dom.attrs.getRealValue=function(e,n){return"true"===n||"false"===n||-1!==t.dom.attrs.ARRTS_BOOLEAN.indexOf(e)?""===n||e===n||"true"===n:n},t.dom.attrs.toObject=function(e){if(1!==e.nodeType)return{};var n={};return Array.prototype.forEach.call(e.attributes,function(e){n[e.nodeName]=t.dom.attrs.getRealValue(e.nodeName,e.value)}),n}}(e),function(t,e){var n={};t.view={},t.view.create=function(t){return t.mixins=Array.isArray(t.mixins)?t.mixins:[],t.mixins.push(n),e.createClass(t)},t.view.register=function(n,o){return e.DOM[n]=t.view.create(o)},t.view.get=function(t){return e.DOM[t]}}(e,React),function(t,e){e.create=function(n,o){return o=e.isPlainObject(o)?o:{},e.merge(!0,o,{lifecycle:{created:function(){this.xblock=e.element.create(this)},removed:function(){this.xblock.destroy(),delete this.xblock},attributeChanged:function(t,e,n){this.xblock._isMountedComponent()||"xb-static"===t&&null===n&&this.xblock._repaint()}},accessors:{content:{get:function(){return this.xblock._getNodeContent()},set:function(t){this.xblock._setNodeContent(t)}}}}),t.register(n,o)}}(xtag,e),function(t,e,n){function o(t){this._uid=e.uid(),this._name=t.tagName.toLowerCase(),this._node=t,this._init(this._getNodeProps(),this._getNodeContent(),this._callbackInit)}e.element={},e.element.create=function(t){return new o(t)},o.prototype._uid=void 0,o.prototype._name=void 0,o.prototype._node=null,o.prototype._component=null,o.prototype._observer=null,o.prototype.destroy=function(){n.unmountComponentAtNode(this._node),this.unmount()},o.prototype.unmount=function(){this._observer&&this._observer.disconnect(),this._isMountedComponent()&&(this._component.unmountComponent(),this._component=null)},o.prototype.update=function(t,n){if(this._isMountedComponent()){var o=this._getNodeProps(),r="setProps";if(e.merge(!0,o,t),Array.isArray(n)&&n.length){r="replaceProps";var i=this._getCurrentProps();o=e.merge(!0,i,o),o=e.filterObject(o,function(t){return-1===n.indexOf(t)})}o.hasOwnProperty("xb-static")?this._repaint():this._component[r](o)}},o.prototype._init=function(o,r,i){if(!this._isMountedComponent()){o._uid=this._uid;var s=e.view.get(this._name)(o,r);o.hasOwnProperty("xb-static")?(this.unmount(),t.innerHTML(this._node,n.renderComponentToString(s))):this._component=n.renderComponent(s,this._node,this._callbackRender.bind(this,i))}},o.prototype._repaint=function(){var t=e.merge(!0,this._getNodeProps(),this._getCurrentProps()),n=this._getNodeContent();this.destroy(),this._init(t,n,this._callbackRepaint)},o.prototype._callbackInit=function(){t.fireEvent(this._node,"xb-created",{bubbles:!1,cancelable:!1,detail:{xblock:this}})},o.prototype._callbackRepaint=function(){t.fireEvent(this._node,"xb-repaint",{bubbles:!1,cancelable:!1,detail:{xblock:this}})},o.prototype._callbackRender=function(t){this._observer||(this._observer=new MutationObserver(this._callbackMutation.bind(this))),this._observer.observe(this._node,{attributes:!0,childList:!0,characterData:!0,subtree:!1,attributeOldValue:!1,characterDataOldValue:!1}),t&&t.call(this)},o.prototype._callbackMutation=function(t){if(this._isMountedComponent())if(t.some(this._checkNodeChange))this._repaint();else if(t.some(this._checkAttributesChange)){var e=t.filter(this._filterAttributesRemove,this).map(this._mapAttributesName);this.update(null,e)}},o.prototype._getNodeProps=function(){return e.dom.attrs.toObject(this._node)},o.prototype._getNodeContentElement=function(){var e=t.query(this._node,'[data-xb-content="'+this._uid+'"]');return 1===e.length?e[0]:void 0},o.prototype._getNodeContent=function(){if(this._isMountedComponent())return this._component.props.children;var t=this._getNodeContentElement();return t?t.innerHTML:this._node.innerHTML},o.prototype._setNodeContent=function(e){if(this._isMountedComponent())this.update({children:e});else{var n=this._getNodeContentElement();n&&t.innerHTML(n,e)}},o.prototype._isMountedComponent=function(){return this._component&&this._component.isMounted()},o.prototype._getCurrentProps=function(){return this._isMountedComponent()?this._component.props:null},o.prototype._checkNodeChange=function(t){return"childList"===t.type},o.prototype._checkAttributesChange=function(t){return"attributes"===t.type},o.prototype._filterAttributesRemove=function(t){return"attributes"===t.type&&!this._node.hasAttribute(t.attributeName)},o.prototype._mapAttributesName=function(t){return t.attributeName}}(xtag,e,React)}();